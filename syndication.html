---
layout: page
title: Блоги наших программистов
excerpt: Сборная солянка вредных советов
---

<div id="posts">
</div>

<script>
window.addEventListener('load', function() {
	var uris = [
		'http://markshevchenko.pro/feed.xml',
		'https://xenidev.github.io/feed.xml',
	];

	var responseCount = 0;
	var posts = [];

	for (var i = 0; i < uris.length; i++) {
		var request = new XMLHttpRequest();

		request.open('GET', uris[i], true);
		request.onload = function(data) {
			if (data.target.status >= 200 && data.target.status < 300) {
				var feed = data.target.responseXML;
				var entries = feed.querySelectorAll('entry');
				for (var i = 0; i < entries.length; i++) {
					var post = parsePost(entries[i]);
					posts.push(post);
				}
			}

			if (++responseCount == uris.length) {
				posts.sort(function(a, b) {
					return b.published.getTime() - a.published.getTime();
				});

				appendPosts(posts);
			}
		};

		request.send();
	}

	function parsePost(entry) {
		return {
			title: getAttribute(entry, 'link', 'title'),
			href: getAttribute(entry, 'link', 'href'),
			published: new Date(getTextContent(entry, 'published')),
			author: getTextContent(entry, 'author > name'),
			summary: getTextContent(entry, 'summary'),
			image: getAttribute(entry, 'thumbnail', 'url')
		};
	}

	function getAttribute(entry, selector, attributeName) {
		var element = entry.querySelector(selector);

		return (element == null) ? null : element.getAttribute(attributeName);
	}

	function getTextContent(entry, selector) {
		var element = entry.querySelector(selector);

		return (element == null) ? null : element.textContent;
	}

	function appendPosts(posts) {
		var parent = document.getElementById('posts');

		for (var i = 0; i < posts.length; i++)
			appendPost(parent, posts[i]);
	}

	function appendPost(parent, post) {
		var div = document.createElement('div');
		div.setAttribute('class', 'post clearfix');
		appendHeaderLink(div, post.title, post.href);
		
		appendDate(div, post.published);
		appendImage(div, post.image, 'post-image');
		appendParagraph(div, post.summary);

		parent.appendChild(div);
	}

	function appendHeaderLink(parent, title, href) {
		var link = document.createElement('a');
		link.setAttribute('href', href);
		link.appendChild(document.createTextNode(title));
		
		var header = document.createElement('h2');
		header.setAttribute('class', 'post-title');
		header.appendChild(link);

		parent.appendChild(header);
	}

	function appendDate(parent, date) {
		var calendar = document.createElement('span');
		calendar.setAttribute('class', 'fa fa-calendar');

		var p = document.createElement('p');
		p.setAttribute('class', 'post-date');
		p.appendChild(calendar);
		p.appendChild(document.createTextNode(date.toLocaleDateString('ru-RU')));

		parent.appendChild(p);

    }

	function appendParagraph(parent, text, className) {
		if (text == null)
			return;

		var p = document.createElement('p');
		p.setAttribute('class', className);
		p.appendChild(document.createTextNode(text));

		parent.appendChild(p);
	}

	function appendImage(parent, src, className) {
		if (src == null)
			return;

		var img = document.createElement('img');
		img.setAttribute('src', src);
		img.setAttribute('class', className);

		parent.appendChild(img);
	}
});
</script>
